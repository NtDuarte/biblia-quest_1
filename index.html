<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BibliaQuest | Duarte</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #58cc02; --blue: #1cb0f6; --bg: #ffffff; --text: #3c3c3c; --error: #ff4b4b; }
        body { font-family: 'Nunito', sans-serif; background-color: #f7f7f7; margin: 0; display: flex; justify-content: center; color: var(--text); }
        #app { width: 100%; max-width: 480px; background: white; min-height: 100vh; padding: 25px; box-sizing: border-box; display: flex; flex-direction: column; padding-bottom: 100px; }
        .hidden { display: none !important; }
        .card { border: 2px solid #e5e5e5; border-bottom: 6px solid #e5e5e5; border-radius: 20px; padding: 20px; margin: 15px 0; background: white; }
        .header-stats { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 2px solid #e5e5e5; margin-bottom: 20px; }
        .btn-duo { width: 100%; padding: 18px; border: none; border-radius: 16px; font-size: 16px; font-weight: 900; text-transform: uppercase; cursor: pointer; background: var(--primary); color: white; border-bottom: 6px solid #46a302; margin-top: 10px; }
        .btn-duo:active { transform: translateY(4px); border-bottom: 2px solid #46a302; }
        .quiz-option { width: 100%; text-align: left; padding: 15px; margin: 8px 0; border: 2px solid #e5e5e5; border-radius: 15px; background: white; cursor: pointer; font-weight: 700; font-family: 'Nunito'; font-size: 1rem; }
        .nav-bar { display: flex; justify-content: space-around; background: white; border-top: 2px solid #e5e5e5; padding: 15px; position: fixed; bottom: 0; width: 100%; max-width: 480px; box-sizing: border-box; }
        .nav-item { cursor: pointer; font-weight: 900; color: #afafaf; }
        .nav-active { color: var(--blue); }

        /* Estilos do Ranking Atualizados */
        .rank-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #eee; transition: background 0.2s; }
        .rank-item:nth-child(1) { background-color: #fff9e6; } /* Ouro */
        .rank-item:nth-child(2) { background-color: #f2f2f2; } /* Prata */
        .rank-item:nth-child(3) { background-color: #fff2eb; } /* Bronze */
        .rank-pos { font-weight: 900; width: 35px; color: var(--blue); }
        .rank-name { flex-grow: 1; font-weight: 700; margin-left: 10px; text-transform: uppercase; display: flex; flex-direction: column; }
        .rank-xp { font-weight: 900; color: var(--primary); }
        .rank-level { font-size: 0.7rem; color: #afafaf; font-weight: 900; }
    </style>
</head>
<body>

<div id="app">
    <div id="auth-screen">
        <h1 style="text-align:center; color: var(--primary);">BibliaQuest</h1>
        <input type="email" id="login-email" placeholder="E-MAIL" style="width:100%; padding:15px; margin:10px 0; border:2px solid #e5e5e5; border-radius:16px;">
        <input type="password" id="login-pass" placeholder="SENHA" style="width:100%; padding:15px; margin:10px 0; border:2px solid #e5e5e5; border-radius:16px;">
        <button class="btn-duo" onclick="handleAuth('login')">ENTRAR</button>
        <button class="btn-duo" style="background:var(--blue); border-bottom-color:#1899d6" onclick="handleAuth('signup')">CRIAR CONTA</button>
    </div>

    <div id="main-screen" class="hidden">
        <div class="header-stats">
            <div>
                <b id="user-display" style="color:var(--primary)">USU√ÅRIO</b> 
                <div style="font-size: 0.8rem; color: #afafaf; margin-top: 5px;">N√çVEL <span id="level-val">1</span></div>
            </div>
            <div style="display:flex; align-items:center; gap:10px;">
                <div style="text-align:right">
                    <span>üî• <b id="streak-val">0</b></span>
                    <span style="color:var(--blue); margin-left:10px;">üíé <b id="xp-val">0</b></span>
                </div>
                <button style="background:#ff4b4b; color:white; border:none; padding:8px 12px; border-radius:12px; font-weight:900; cursor:pointer;" onclick="logout()">SAIR</button>
            </div>
        </div>
        
        <div id="tab-home">
            <div class="card">
                <h3 style="color: var(--blue); margin:0">üìñ DESAFIO DO DIA</h3>
                <p id="verse-text" style="font-weight: 700; font-size: 1.1rem; line-height: 1.4;">Buscando novo vers√≠culo...</p>
                <div id="verse-ref" style="color: #afafaf; font-weight: 900; font-size: 0.8rem;"></div>
            </div>
            <button id="btn-study" class="btn-duo" onclick="generateStudy()">GERAR ESTUDO PROFUNDO</button>
            
            <div id="study-area" class="hidden">
                <div class="card" id="ai-response" style="background: #f0fbff; font-size: 1rem; line-height: 1.5; white-space: pre-wrap;"></div>
                <div id="quiz-container" class="card" style="border-color: var(--blue);">
                    <h4 id="quiz-question" style="margin-top:0; color: var(--blue);"></h4>
                    <div id="quiz-options"></div>
                </div>
            </div>
        </div>

        <div id="tab-rank" class="hidden">
            <h2 style="text-align:center; color: var(--blue);">üèÜ RANKING GLOBAL</h2>
            <div id="ranking-list" class="card" style="padding:0"></div>
        </div>

        <div id="tab-config" class="hidden">
            <h2 style="text-align:center; color: #afafaf;">‚öôÔ∏è CONFIGURA√á√ïES</h2>
            <div class="card" style="text-align:center">
                <p>A intelig√™ncia artificial est√° automatizada via servidor seguro.</p>
                <button class="btn-duo" onclick="resetVerses()">REINICIAR LISTA DE VERS√çCULOS</button>
            </div>
        </div>
    </div>

    <div id="nav" class="nav-bar hidden">
        <div class="nav-item nav-active" id="nav-home" onclick="showTab('home')">ESTUDO</div>
        <div class="nav-item" id="nav-rank" onclick="showTab('rank')">RANKING</div>
        <div class="nav-item" id="nav-config" onclick="showTab('config')">‚öôÔ∏è</div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, updateDoc, increment, collection, query, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCAqU2eK-r5BBSud1nSZJHSbykATXdQNS4",
        authDomain: "bibliaquest-fbc44.firebaseapp.com",
        projectId: "bibliaquest-fbc44",
        storageBucket: "bibliaquest-fbc44.firebasestorage.app",
        messagingSenderId: "670585434397",
        appId: "1:670585434397:web:6d699582986e8dcbc6f1f4",
        measurementId: "G-H0Z7T8LCPE"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    let correctAnswer = "";

    // Base de Dados Consolidada (IDs 1 a 300)
    const BIBLE_DATABASE = [
        { id: 1, text: "No princ√≠pio, criou Deus os c√©us e a terra.", ref: "G√™nesis 1:1" },
        { id: 2, text: "O Senhor √© o meu pastor; nada me faltar√°.", ref: "Salmos 23:1" },
        { id: 3, text: "Tudo posso naquele que me fortalece.", ref: "Filipenses 4:13" },
        { id: 4, text: "L√¢mpada para os meus p√©s √© tua palavra e luz, para o meu caminho.", ref: "Salmos 119:105" },
        { id: 5, text: "O cora√ß√£o alegre √© bom rem√©dio, mas o esp√≠rito abatido seca at√© os ossos.", ref: "Prov√©rbios 17:22" },
        { id: 6, text: "Buscai, pois, em primeiro lugar, o seu reino e a sua justi√ßa.", ref: "Mateus 6:33" },
        { id: 7, text: "O Senhor te aben√ßoe e te guarde.", ref: "N√∫meros 6:24" },
        { id: 8, text: "Deem gra√ßas ao Senhor, porque ele √© bom; o seu amor dura para sempre.", ref: "Salmos 136:1" },
        { id: 9, text: "Seja forte e corajoso! N√£o desanime nem tenha medo.", ref: "Josu√© 1:9" },
        { id: 10, text: "Eu sou o caminho, e a verdade, e a vida.", ref: "Jo√£o 14:6" },
        { id: 11, text: "O temor do Senhor √© o princ√≠pio da sabedoria.", ref: "Prov√©rbios 1:7" },
        { id: 12, text: "Alegrai-vos sempre no Senhor; outra vez digo: alegrai-vos.", ref: "Filipenses 4:4" },
        { id: 13, text: "Mas os que esperam no Senhor renovar√£o as suas for√ßas.", ref: "Isa√≠as 40:31" },
        { id: 14, text: "Mil cair√£o ao teu lado, e dez mil, √† tua direita, mas tu n√£o ser√°s atingido.", ref: "Salmos 91:7" },
        { id: 15, text: "Honra a teu pai e a tua m√£e.", ref: "√äxodo 20:12" },
        { id: 16, text: "O amor √© paciente, o amor √© bondoso.", ref: "1 Cor√≠ntios 13:4" },
        { id: 17, text: "Ensina-nos a contar os nossos dias para que alcancemos cora√ß√£o s√°bio.", ref: "Salmos 90:12" },
        { id: 18, text: "Porque Deus amou o mundo de tal maneira que deu o seu Filho unig√™nito.", ref: "Jo√£o 3:16" },
        { id: 19, text: "A resposta branda desvia o furor, mas a palavra dura suscita a ira.", ref: "Prov√©rbios 15:1" },
        { id: 20, text: "Tudo quanto fizerdes, fazei-o de todo o cora√ß√£o, como ao Senhor.", ref: "Colossenses 3:23" },
        { id: 21, text: "Lancem sobre ele toda a sua ansiedade, porque ele tem cuidado de voc√™s.", ref: "1 Pedro 5:7" },
        { id: 22, text: "Entregue o seu caminho ao Senhor; confie nele, e ele agir√°.", ref: "Salmos 37:5" },
        { id: 23, text: "Confie no Senhor de todo o seu cora√ß√£o e n√£o se apoie em seu pr√≥prio entendimento.", ref: "Prov√©rbios 3:5" },
        { id: 24, text: "N√£o tema, pois estou com voc√™; n√£o tenha medo, pois sou o seu Deus.", ref: "Isa√≠as 41:10" },
        { id: 25, text: "Sabemos que Deus age em todas as coisas para o bem daqueles que o amam.", ref: "Romanos 8:28" },
        { id: 26, text: "Bem-aventurados os limpos de cora√ß√£o, porque eles ver√£o a Deus.", ref: "Mateus 5:8" },
        { id: 27, text: "Deus √© o nosso ref√∫gio e a nossa fortaleza, aux√≠lio sempre presente na adversidade.", ref: "Salmos 46:1" },
        { id: 28, text: "E a paz de Deus, que excede todo o entendimento, guardar√° o vosso cora√ß√£o.", ref: "Filipenses 4:7" },
        { id: 29, text: "Porque sou eu que conhe√ßo os planos que tenho para voc√™s, diz o Senhor.", ref: "Jeremias 29:11" },
        { id: 30, text: "O meu socorro vem do Senhor, que fez os c√©us e a terra.", ref: "Salmos 121:2" },
        { id: 31, text: "O Senhor √© bom, um ref√∫gio em tempos de ang√∫stia. Ele cuida dos que nele confiam.", ref: "Naum 1:7" },
        { id: 32, text: "Pe√ßam, e lhes ser√° dado; busquem, e encontrar√£o; batam, e a porta lhes ser√° aberta.", ref: "Mateus 7:7" },
        { id: 33, text: "Pois onde estiver o seu tesouro, ali tamb√©m estar√° o seu cora√ß√£o.", ref: "Mateus 6:21" },
        { id: 34, text: "O meu Deus suprir√° todas as vossas necessidades segundo as suas riquezas.", ref: "Filipenses 4:19" },
        { id: 35, text: "O Senhor √© a minha for√ßa e o meu escudo; nele o meu cora√ß√£o confia.", ref: "Salmos 28:7" },
        { id: 36, text: "Tudo o que fizerem, fa√ßam de bom cora√ß√£o, como se estivessem servindo ao Senhor.", ref: "Colossenses 3:23" },
        { id: 37, text: "Aquele que habita no abrigo do Alt√≠ssimo e descansa √† sombra do Todo-poderoso.", ref: "Salmos 91:1" },
        { id: 38, text: "Vigiem e orem para que n√£o caiam em tenta√ß√£o. O esp√≠rito est√° pronto, mas a carne √© fraca.", ref: "Mateus 26:41" },
        { id: 39, text: "A tua palavra √© l√¢mpada que ilumina os meus passos e luz que clareia o meu caminho.", ref: "Salmos 119:105" },
        { id: 40, text: "O cora√ß√£o do homem planeja o seu caminho, mas o Senhor lhe dirige os passos.", ref: "Prov√©rbios 16:9" },
        { id: 41, text: "Deixo-vos a paz, a minha paz vos dou; n√£o vo-la dou como o mundo a d√°.", ref: "Jo√£o 14:27" },
        { id: 42, text: "Mas, em todas estas coisas, somos mais do que vencedores, por aquele que nos amou.", ref: "Romanos 8:37" },
        { id: 43, text: "A minha alma espera somente em Deus; dele vem a minha salva√ß√£o.", ref: "Salmos 62:1" },
        { id: 44, text: "O fruto do Esp√≠rito √© amor, alegria, paz, paci√™ncia, amabilidade, bondade e fidelidade.", ref: "G√°latas 5:22" },
        { id: 45, text: "Sede fortes e corajosos; n√£o temais, nem vos espanteis diante deles.", ref: "Deuteron√¥mio 31:6" },
        { id: 46, text: "At√© aqui nos ajudou o Senhor.", ref: "1 Samuel 7:12" },
        { id: 47, text: "O Senhor √© o meu forte e o meu escudo; nele confiou o meu cora√ß√£o, e fui socorrido.", ref: "Salmos 28:7" },
        { id: 48, text: "Pois nada √© imposs√≠vel para Deus.", ref: "Lucas 1:37" },
        { id: 49, text: "A sabedoria √© melhor do que as joias, e nada do que se possa desejar se compara a ela.", ref: "Prov√©rbios 8:11" },
        { id: 50, text: "Em paz me deito e logo adorme√ßo, pois s√≥ tu, Senhor, me fazes viver em seguran√ßa.", ref: "Salmos 4:8" },
        { id: 51, text: "N√£o andem ansiosos por coisa alguma, mas em tudo apresentem seus pedidos a Deus.", ref: "Filipenses 4:6" },
        { id: 52, text: "Honra ao Senhor com os teus bens e com as prim√≠cias de toda a tua renda.", ref: "Prov√©rbios 3:9" },
        { id: 53, text: "Escondi a tua palavra no meu cora√ß√£o, para eu n√£o pecar contra ti.", ref: "Salmos 119:11" },
        { id: 54, text: "O Senhor lutar√° por voc√™s; t√£o somente acalmem-se.", ref: "√äxodo 14:14" },
        { id: 55, text: "Toda a Escritura √© inspirada por Deus e √∫til para o ensino e a corre√ß√£o.", ref: "2 Tim√≥teo 3:16" },
        { id: 56, text: "A vontade de Deus √© boa, perfeita e agrad√°vel.", ref: "Romanos 12:2" },
        { id: 57, text: "Se Deus √© por n√≥s, quem ser√° contra n√≥s?", ref: "Romanos 8:31" },
        { id: 58, text: "Para o homem √© imposs√≠vel, mas para Deus n√£o; todas as coisas s√£o poss√≠veis para Deus.", ref: "Marcos 10:27" },
        { id: 59, text: "Grandes coisas fez o Senhor por n√≥s, e por isso estamos alegres.", ref: "Salmos 126:3" },
        { id: 60, text: "Eis que estou √† porta e bato; se algu√©m ouvir a minha voz e abrir a porta, entrarei.", ref: "Apocalipse 3:20" },
        { id: 61, text: "A gra√ßa do Senhor Jesus Cristo seja com todos. Am√©m!", ref: "Apocalipse 22:21" },
        { id: 62, text: "Agrada-te do Senhor, e ele satisfar√° os desejos do teu cora√ß√£o.", ref: "Salmos 37:4" },
        { id: 63, text: "Justificados, pois, mediante a f√©, temos paz com Deus por meio de nosso Senhor Jesus.", ref: "Romanos 5:1" },
        { id: 64, text: "O que me consola na minha ang√∫stia √© que a tua palavra me vivifica.", ref: "Salmos 119:50" },
        { id: 65, text: "A gl√≥ria desta √∫ltima casa ser√° maior do que a da primeira.", ref: "Ageu 2:9" },
        { id: 66, text: "O Senhor √© o meu ref√∫gio e o meu Deus √© a rocha em que me abrigo.", ref: "Salmos 94:22" },
        { id: 67, text: "Pela gra√ßa sois salvos, mediante a f√©; e isto n√£o vem de v√≥s, √© dom de Deus.", ref: "Ef√©sios 2:8" },
        { id: 68, text: "No mundo tereis afli√ß√µes, mas tende bom √¢nimo; eu venci o mundo.", ref: "Jo√£o 16:33" },
        { id: 69, text: "O Senhor completar√° o que a meu respeito ordenou.", ref: "Salmos 138:8" },
        { id: 70, text: "Aquele que come√ßou a boa obra em voc√™s vai complet√°-la at√© o dia de Cristo Jesus.", ref: "Filipenses 1:6" },
        { id: 71, text: "Reconhe√ßa o Senhor em todos os seus caminhos, e ele endireitar√° as suas veredas.", ref: "Prov√©rbios 3:6" },
        { id: 72, text: "Provem e vejam como o Senhor √© bom. Como √© feliz o homem que nele se refugia!", ref: "Salmos 34:8" },
        { id: 73, text: "Assim brilhe a luz de voc√™s diante dos homens, para que vejam as suas boas obras.", ref: "Mateus 5:16" },
        { id: 74, text: "Entregue suas preocupa√ß√µes ao Senhor, e ele o suster√°; jamais permitir√° que o justo caia.", ref: "Salmos 55:22" },
        { id: 75, text: "Portanto, se algu√©m est√° em Cristo, √© nova cria√ß√£o; as coisas antigas j√° passaram.", ref: "2 Cor√≠ntios 5:17" },
        { id: 76, text: "Ora, a f√© √© a certeza daquilo que esperamos e a prova das coisas que n√£o vemos.", ref: "Hebreus 11:1" },
        { id: 77, text: "Este √© o dia que o Senhor fez; exultemos e alegremo-nos nele.", ref: "Salmos 118:24" },
        { id: 78, text: "N√≥s amamos porque ele nos amou primeiro.", ref: "1 Jo√£o 4:19" },
        { id: 79, text: "Bendiga ao Senhor a minha alma! Bendiga ao Senhor todo o meu ser!", ref: "Salmos 103:1" },
        { id: 80, text: "Pois √© Deus quem efetua em voc√™s tanto o querer quanto o realizar.", ref: "Filipenses 2:13" },
        { id: 81, text: "O Senhor √© misericordioso e compassivo, paciente e transbordante de amor.", ref: "Salmos 103:8" },
        { id: 82, text: "Pois o Senhor d√° sabedoria; da sua boca procedem o conhecimento e o discernimento.", ref: "Prov√©rbios 2:6" },
        { id: 83, text: "A tua palavra √© a verdade.", ref: "Jo√£o 17:17" },
        { id: 84, text: "Respondeu Jesus: 'Eu sou o p√£o da vida. Aquele que vem a mim nunca ter√° fome'.", ref: "Jo√£o 6:35" },
        { id: 85, text: "Clame a mim e eu responderei e direi a voc√™ coisas grandiosas e insond√°veis.", ref: "Jeremias 33:3" },
        { id: 86, text: "O caminho de Deus √© perfeito; a palavra do Senhor √© comprovadamente verdadeira.", ref: "2 Samuel 22:31" },
        { id: 87, text: "Deus √© esp√≠rito, e √© necess√°rio que os seus adoradores o adorem em esp√≠rito e em verdade.", ref: "Jo√£o 4:24" },
        { id: 88, text: "Vejam como √© grande o amor que o Pai nos concedeu: sermos chamados filhos de Deus!", ref: "1 Jo√£o 3:1" },
        { id: 89, text: "Alegrem-se na esperan√ßa, sejam pacientes na tribula√ß√£o, perseverem na ora√ß√£o.", ref: "Romanos 12:12" },
        { id: 90, text: "Acima de tudo, guarde o seu cora√ß√£o, pois dele depende toda a sua vida.", ref: "Prov√©rbios 4:23" },
        { id: 91, text: "O Senhor √© bom para todos; a sua compaix√£o alcan√ßa todas as suas criaturas.", ref: "Salmos 145:9" },
        { id: 92, text: "Confie no Senhor para sempre, pois o Senhor, somente o Senhor, √© a Rocha eterna.", ref: "Isa√≠as 26:4" },
        { id: 93, text: "Pois o sal√°rio do pecado √© a morte, mas o dom gratuito de Deus √© a vida eterna.", ref: "Romanos 6:23" },
        { id: 94, text: "Busquem o Senhor enquanto √© poss√≠vel ach√°-lo; clamem por ele enquanto est√° perto.", ref: "Isa√≠as 55:6" },
        { id: 95, text: "Se confessarmos os nossos pecados, ele √© fiel e justo para nos perdoar.", ref: "1 Jo√£o 1:9" },
        { id: 96, text: "O Senhor renova as minhas for√ßas e me guia por caminhos caminhos de justi√ßa.", ref: "Salmos 23:3" },
        { id: 97, text: "A soberba precede a destrui√ß√£o, e a altivez do esp√≠rito precede a queda.", ref: "Prov√©rbios 16:18" },
        { id: 98, text: "Pois a palavra de Deus √© viva e eficaz, e mais afiada que qualquer espada de dois gumes.", ref: "Hebreus 4:12" },
        { id: 99, text: "N√£o se deixem vencer pelo mal, mas ven√ßam o mal com o bem.", ref: "Romanos 12:21" },
        { id: 100, text: "Deus √© a nossa for√ßa e o nosso escudo.", ref: "Salmos 28:7" },
        { id: 101, text: "A paz deixo com voc√™s; a minha paz lhes dou.", ref: "Jo√£o 14:27" },
        { id: 102, text: "Honra o Senhor com teus bens e com as prim√≠cias de toda a tua colheita.", ref: "Prov√©rbios 3:9" },
        { id: 103, text: "O Senhor √© o meu aux√≠lio; n√£o terei medo. O que me pode fazer o homem?", ref: "Hebreus 13:6" },
        { id: 104, text: "Sejam fortes e corajosos. N√£o tenham medo nem fiquem apavorados.", ref: "Deuteron√¥mio 31:6" },
        { id: 105, text: "O Senhor sustenta todos os que caem e levanta todos os que est√£o abatidos.", ref: "Salmos 145:14" },
        { id: 106, text: "Nem s√≥ de p√£o viver√° o homem, mas de toda palavra que procede da boca de Deus.", ref: "Mateus 4:4" },
        { id: 107, text: "O amor nunca falha.", ref: "1 Cor√≠ntios 13:8" },
        { id: 108, text: "Vinde a mim, todos os que estais cansados e oprimidos, e eu vos aliviarei.", ref: "Mateus 11:28" },
        { id: 109, text: "O Senhor guarda todos os que o amam.", ref: "Salmos 145:20" },
        { id: 110, text: "Deus √© amor.", ref: "1 Jo√£o 4:8" },
        { id: 111, text: "Aquele que tem os meus mandamentos e os guarda, esse √© o que me ama.", ref: "Jo√£o 14:21" },
        { id: 112, text: "A justi√ßa engrandece a na√ß√£o, mas o pecado √© uma vergonha para qualquer povo.", ref: "Prov√©rbios 14:34" },
        { id: 113, text: "Ensina a crian√ßa no caminho em que deve andar.", ref: "Prov√©rbios 22:6" },
        { id: 114, text: "Sede v√≥s tamb√©m pacientes e fortalecei o vosso cora√ß√£o.", ref: "Tiago 5:8" },
        { id: 115, text: "A gra√ßa de nosso Senhor Jesus Cristo seja com todos v√≥s.", ref: "Apocalipse 22:21" },
        { id: 116, text: "A amizade do Senhor √© para os que o temem.", ref: "Salmos 25:14" },
        { id: 117, text: "Bem-aventurados os que promovem a paz, pois ser√£o chamados filhos de Deus.", ref: "Mateus 5:9" },
        { id: 118, text: "O Senhor dar√° for√ßa ao seu povo; o Senhor aben√ßoar√° o seu povo com paz.", ref: "Salmos 29:11" },
        { id: 119, text: "Em Deus, cuja palavra eu louvo, em Deus eu confio e n√£o temerei.", ref: "Salmos 56:4" },
        { id: 120, text: "Tudo o que pedirem em ora√ß√£o, creiam que j√° o receberam, e assim suceder√°.", ref: "Marcos 11:24" },
        { id: 121, text: "As miseric√≥rdias do Senhor s√£o a causa de n√£o sermos consumidos.", ref: "Lamenta√ß√µes 3:22" },
        { id: 122, text: "Escondi a tua palavra no meu cora√ß√£o para n√£o pecar contra ti.", ref: "Salmos 119:11" },
        { id: 123, text: "Quem tem ouvidos, ou√ßa o que o Esp√≠rito diz √†s igrejas.", ref: "Apocalipse 2:7" },
        { id: 124, text: "O Senhor √© bom, um ref√∫gio em tempos de ang√∫stia.", ref: "Naum 1:7" },
        { id: 125, text: "Digno √©s, Senhor, de receber gl√≥ria, honra e poder.", ref: "Apocalipse 4:11" },
        { id: 126, text: "Grandes e maravilhosas s√£o as tuas obras, Senhor Deus Todo-poderoso!", ref: "Apocalipse 15:3" },
        { id: 127, text: "S√™ fiel at√© √† morte, e dar-te-ei a coroa da vida.", ref: "Apocalipse 2:10" },
        { id: 128, text: "N√£o fomos n√≥s que amamos a Deus, mas foi ele que nos amou.", ref: "1 Jo√£o 4:10" },
        { id: 129, text: "O que ganha almas s√°bio √©.", ref: "Prov√©rbios 11:30" },
        { id: 130, text: "Filhinhos, n√£o amemos de palavra, nem de l√≠ngua, mas por obra e em verdade.", ref: "1 Jo√£o 3:18" },
        { id: 131, text: "Provai e vede que o Senhor √© bom.", ref: "Salmos 34:8" },
        { id: 132, text: "O Senhor √© a por√ß√£o da minha heran√ßa e o meu c√°lice.", ref: "Salmos 16:5" },
        { id: 133, text: "Buscai o Senhor e a sua for√ßa; buscai a sua face continuamente.", ref: "Salmos 105:4" },
        { id: 134, text: "Deus √© o nosso ref√∫gio e fortaleza.", ref: "Salmos 46:1" },
        { id: 135, text: "O nome do Senhor √© uma torre forte; os justos correm para ela e est√£o seguros.", ref: "Prov√©rbios 18:10" },
        { id: 136, text: "Sede agradecidos.", ref: "Colossenses 3:15" },
        { id: 137, text: "Porque para Deus nada √© imposs√≠vel.", ref: "Lucas 1:37" },
        { id: 138, text: "A palavra do Senhor permanece para sempre.", ref: "1 Pedro 1:25" },
        { id: 139, text: "Eis que fa√ßo novas todas as coisas.", ref: "Apocalipse 21:5" },
        { id: 140, text: "O Senhor redime a alma dos seus servos.", ref: "Salmos 34:22" },
        { id: 141, text: "Orai sem cessar.", ref: "1 Tessalonicenses 5:17" },
        { id: 142, text: "Em tudo dai gra√ßas.", ref: "1 Tessalonicenses 5:18" },
        { id: 143, text: "N√£o apagueis o Esp√≠rito.", ref: "1 Tessalonicenses 5:19" },
        { id: 144, text: "Retende o que √© bom.", ref: "1 Tessalonicenses 5:21" },
        { id: 145, text: "Abstende-vos de toda apar√™ncia do mal.", ref: "1 Tessalonicenses 5:22" },
        { id: 146, text: "O Senhor √© o meu aux√≠lio; n√£o temerei.", ref: "Salmos 118:6" },
        { id: 147, text: "A gra√ßa de nosso Senhor Jesus Cristo seja convosco.", ref: "1 Tessalonicenses 5:28" },
        { id: 148, text: "Combati o bom combate, acabei a carreira, guardei a f√©.", ref: "2 Tim√≥teo 4:7" },
        { id: 149, text: "Fiel √© o que vos chama, o qual tamb√©m o far√°.", ref: "1 Tessalonicenses 5:24" },
        { id: 150, text: "Alegrai-vos na esperan√ßa.", ref: "Romanos 12:12" },
        { id: 151, text: "Sede pacientes na tribula√ß√£o.", ref: "Romanos 12:12" },
        { id: 152, text: "Perseverai na ora√ß√£o.", ref: "Romanos 12:12" },
        { id: 153, text: "Aben√ßoai os que vos perseguem.", ref: "Romanos 12:14" },
        { id: 154, text: "Alegrai-vos com os que se alegram.", ref: "Romanos 12:15" },
        { id: 155, text: "Chorai com os que choram.", ref: "Romanos 12:15" },
        { id: 156, text: "N√£o sejais s√°bios em v√≥s mesmos.", ref: "Romanos 12:16" },
        { id: 157, text: "A ningu√©m torneis mal por mal.", ref: "Romanos 12:17" },
        { id: 158, text: "Tende paz com todos os homens.", ref: "Romanos 12:18" },
        { id: 159, text: "Vence o mal com o bem.", ref: "Romanos 12:21" },
        { id: 160, text: "A justi√ßa de Deus se manifesta pela f√©.", ref: "Romanos 1:17" },
        { id: 161, text: "O justo viver√° pela f√©.", ref: "Romanos 1:17" },
        { id: 162, text: "Fomos sepultados com ele pelo batismo.", ref: "Romanos 6:4" },
        { id: 163, text: "O dom gratuito de Deus √© a vida eterna.", ref: "Romanos 6:23" },
        { id: 164, text: "Quem nos separar√° do amor de Cristo?", ref: "Romanos 8:35" },
        { id: 165, text: "Somos mais do que vencedores.", ref: "Romanos 8:37" },
        { id: 166, text: "Se Deus √© por n√≥s, quem ser√° contra n√≥s?", ref: "Romanos 8:31" },
        { id: 167, text: "A f√© vem pelo ouvir a palavra de Deus.", ref: "Romanos 10:17" },
        { id: 168, text: "Oferecei os vossos corpos em sacrif√≠cio vivo.", ref: "Romanos 12:1" },
        { id: 169, text: "N√£o vos conformeis com este mundo.", ref: "Romanos 12:2" },
        { id: 170, text: "Transformai-vos pela renova√ß√£o da vossa mente.", ref: "Romanos 12:2" },
        { id: 171, text: "Amai-vos cordialmente uns aos outros.", ref: "Romanos 12:10" },
        { id: 172, text: "O amor n√£o faz mal ao pr√≥ximo.", ref: "Romanos 13:10" },
        { id: 173, text: "O cumprimento da lei √© o amor.", ref: "Romanos 13:10" },
        { id: 174, text: "Revesti-vos do Senhor Jesus Cristo.", ref: "Romanos 13:14" },
        { id: 175, text: "Cada um de n√≥s dar√° conta de si mesmo a Deus.", ref: "Romanos 14:12" },
        { id: 176, text: "O reino de Deus √© justi√ßa, paz e alegria.", ref: "Romanos 14:17" },
        { id: 177, text: "Sigamos as coisas que servem para a paz.", ref: "Romanos 14:19" },
        { id: 178, text: "Tudo o que n√£o √© de f√© √© pecado.", ref: "Romanos 14:23" },
        { id: 179, text: "Cristo n√£o agradou a si mesmo.", ref: "Romanos 15:3" },
        { id: 180, text: "Sede un√¢nimes entre v√≥s.", ref: "Romanos 15:5" },
        { id: 181, text: "Recebei-vos uns aos outros.", ref: "Romanos 15:7" },
        { id: 182, text: "O Deus de esperan√ßa vos encha de todo o gozo.", ref: "Romanos 15:13" },
        { id: 183, text: "Abundeis em esperan√ßa pelo poder do Esp√≠rito Santo.", ref: "Romanos 15:13" },
        { id: 184, text: "Saudai-vos uns aos outros com santo √≥sculo.", ref: "Romanos 16:16" },
        { id: 185, text: "O Deus de paz esmagar√° em breve Satan√°s.", ref: "Romanos 16:20" },
        { id: 186, text: "A Deus unicamente s√°bio seja dada gl√≥ria.", ref: "Romanos 16:27" },
        { id: 187, text: "Fiel √© Deus, pelo qual fostes chamados.", ref: "1 Cor√≠ntios 1:9" },
        { id: 188, text: "A palavra da cruz √© poder de Deus.", ref: "1 Cor√≠ntios 1:18" },
        { id: 189, text: "Aquele que se gloria, glorie-se no Senhor.", ref: "1 Cor√≠ntios 1:31" },
        { id: 190, text: "A vossa f√© n√£o se apoie em sabedoria dos homens.", ref: "1 Cor√≠ntios 2:5" },
        { id: 191, text: "As coisas que o olho n√£o viu s√£o as que Deus preparou.", ref: "1 Cor√≠ntios 2:9" },
        { id: 192, text: "Ningu√©m pode p√¥r outro fundamento al√©m de Cristo.", ref: "1 Cor√≠ntios 3:11" },
        { id: 193, text: "V√≥s sois o templo de Deus.", ref: "1 Cor√≠ntios 3:16" },
        { id: 194, text: "O Esp√≠rito de Deus habita em v√≥s.", ref: "1 Cor√≠ntios 3:16" },
        { id: 195, text: "A sabedoria deste mundo √© loucura diante de Deus.", ref: "1 Cor√≠ntios 3:19" },
        { id: 196, text: "Tudo √© vosso, e v√≥s de Cristo, e Cristo de Deus.", ref: "1 Cor√≠ntios 3:23" },
        { id: 197, text: "Requer-se dos despenseiros que cada um se ache fiel.", ref: "1 Cor√≠ntios 4:2" },
        { id: 198, text: "O reino de Deus n√£o consiste em palavras, mas em poder.", ref: "1 Cor√≠ntios 4:20" },
        { id: 199, text: "Fostes comprados por bom pre√ßo; glorificai, pois, a Deus.", ref: "1 Cor√≠ntios 6:20" },
        { id: 200, text: "Tudo o que fizerdes, fazei-o para a gl√≥ria de Deus.", ref: "1 Cor√≠ntios 10:31" },
        { id: 201, text: "Sede firmes e constantes, sempre abundantes na obra do Senhor.", ref: "1 Cor√≠ntios 15:58" },
        { id: 202, text: "Bendito seja o Deus e Pai das miseric√≥rdias.", ref: "2 Cor√≠ntios 1:3" },
        { id: 203, text: "Ainda que o nosso homem exterior se corrompa, o interior se renova.", ref: "2 Cor√≠ntios 4:16" },
        { id: 204, text: "√Äquele que n√£o conheceu pecado, o fez pecado por n√≥s.", ref: "2 Cor√≠ntios 5:21" },
        { id: 205, text: "Deus ama ao que d√° com alegria.", ref: "2 Cor√≠ntios 9:7" },
        { id: 206, text: "Estai, pois, firmes na liberdade com que Cristo nos libertou.", ref: "G√°latas 5:1" },
        { id: 207, text: "Andai em Esp√≠rito e n√£o cumprireis a concupisc√™ncia da carne.", ref: "G√°latas 5:16" },
        { id: 208, text: "Se vivemos em Esp√≠rito, andemos tamb√©m em Esp√≠rito.", ref: "G√°latas 5:25" },
        { id: 209, text: "Somos feitura sua, criados em Cristo Jesus para as boas obras.", ref: "Ef√©sios 2:10" },
        { id: 210, text: "Irai-vos e n√£o pequeis; n√£o se ponha o sol sobre a vossa ira.", ref: "Ef√©sios 4:26" },
        { id: 211, text: "Sede, pois, imitadores de Deus, como filhos amados.", ref: "Ef√©sios 5:1" },
        { id: 212, text: "Dando sempre gra√ßas por tudo a nosso Deus e Pai.", ref: "Ef√©sios 5:20" },
        { id: 213, text: "Nada fa√ßais por contenda ou por vangl√≥ria, mas por humildade.", ref: "Filipenses 2:3" },
        { id: 214, text: "Haja em v√≥s o mesmo sentimento que houve em Cristo Jesus.", ref: "Filipenses 2:5" },
        { id: 215, text: "Prossigo para o alvo, pelo pr√™mio da soberana voca√ß√£o.", ref: "Filipenses 3:14" },
        { id: 216, text: "Tudo o que √© verdadeiro, honesto e justo, nisso pensai.", ref: "Filipenses 4:8" },
        { id: 217, text: "Pensai nas coisas que s√£o de cima, e n√£o nas da terra.", ref: "Colossenses 3:2" },
        { id: 218, text: "Tudo o que fizerdes, fazei-o em nome do Senhor Jesus.", ref: "Colossenses 3:17" },
        { id: 219, text: "Perseverai em ora√ß√£o, velando nela com a√ß√£o de gra√ßas.", ref: "Colossenses 4:2" },
        { id: 220, text: "Regozijai-vos sempre.", ref: "1 Tessalonicenses 5:16" },
        { id: 221, text: "Fiel √© o Senhor, que vos confortar√° e guardar√° do maligno.", ref: "2 Tessalonicenses 3:3" },
        { id: 222, text: "Ningu√©m despreze a tua mocidade; s√™ o exemplo dos fi√©is.", ref: "1 Tim√≥teo 4:12" },
        { id: 223, text: "Milita a boa mil√≠cia da f√©, toma posse da vida eterna.", ref: "1 Tim√≥teo 6:12" },
        { id: 224, text: "Deus n√£o nos deu o esp√≠rito de temor, mas de fortaleza.", ref: "2 Tim√≥teo 1:7" },
        { id: 225, text: "Procura apresentar-te a Deus aprovado como obreiro.", ref: "2 Tim√≥teo 2:15" },
        { id: 226, text: "Toda a Escritura √© divinamente inspirada e proveitosa.", ref: "2 Tim√≥teo 3:16" },
        { id: 227, text: "A gra√ßa de Deus se h√° manifestado, trazendo salva√ß√£o.", ref: "Tito 2:11" },
        { id: 228, text: "Cheguemo-nos, pois, com confian√ßa ao trono da gra√ßa.", ref: "Hebreus 4:16" },
        { id: 229, text: "Retenhamos firmes a confiss√£o da nossa esperan√ßa.", ref: "Hebreus 10:23" },
        { id: 230, text: "Corramos com paci√™ncia a carreira que nos est√° proposta.", ref: "Hebreus 12:1" },
        { id: 231, text: "Olhando para Jesus, autor e consumador da f√©.", ref: "Hebreus 12:2" },
        { id: 232, text: "N√£o te deixarei, nem te desampararei.", ref: "Hebreus 13:5" },
        { id: 233, text: "Jesus Cristo √© o mesmo, ontem, e hoje, e eternamente.", ref: "Hebreus 13:8" },
        { id: 234, text: "Se algum de v√≥s tem falta de sabedoria, pe√ßa-a a Deus.", ref: "Tiago 1:5" },
        { id: 235, text: "Toda a boa d√°diva e todo o dom perfeito vem do alto.", ref: "Tiago 1:17" },
        { id: 236, text: "Sede prontos para ouvir, tardios para falar.", ref: "Tiago 1:19" },
        { id: 237, text: "Sede cumpridores da palavra, e n√£o somente ouvintes.", ref: "Tiago 1:22" },
        { id: 238, text: "Sujeitai-vos a Deus, resisti ao diabo, e ele fugir√°.", ref: "Tiago 4:7" },
        { id: 239, text: "Chegai-vos a Deus, e ele se chegar√° a v√≥s.", ref: "Tiago 4:8" },
        { id: 240, text: "A ora√ß√£o feita por um justo pode muito em seus efeitos.", ref: "Tiago 5:16" },
        { id: 241, text: "Santificai a Cristo, como Senhor, em vossos cora√ß√µes.", ref: "1 Pedro 3:15" },
        { id: 242, text: "Tende ardente amor uns para com os outros.", ref: "1 Pedro 4:8" },
        { id: 243, text: "Humilhai-vos debaixo da potente m√£o de Deus.", ref: "1 Pedro 5:6" },
        { id: 244, text: "Crescei na gra√ßa e conhecimento de nosso Senhor.", ref: "2 Pedro 3:18" },
        { id: 245, text: "O sangue de Jesus Cristo nos purifica de todo pecado.", ref: "1 Jo√£o 1:7" },
        { id: 246, text: "Se algu√©m pecar, temos um Advogado para com o Pai.", ref: "1 Jo√£o 2:1" },
        { id: 247, text: "N√£o ameis o mundo, nem o que no mundo h√°.", ref: "1 Jo√£o 2:15" },
        { id: 248, text: "Aquele que faz a vontade de Deus permanece para sempre.", ref: "1 Jo√£o 2:17" },
        { id: 249, text: "Conhecemos o amor nisto: que ele deu a vida por n√≥s.", ref: "1 Jo√£o 3:16" },
        { id: 250, text: "Maior √© o que est√° em v√≥s do que o que est√° no mundo.", ref: "1 Jo√£o 4:4" },
        { id: 251, text: "No amor n√£o h√° temor, antes o amor lan√ßa fora o temor.", ref: "1 Jo√£o 4:18" },
        { id: 252, text: "Esta √© a vit√≥ria que vence o mundo, a nossa f√©.", ref: "1 Jo√£o 5:4" },
        { id: 253, text: "Se pedirmos alguma coisa segundo a sua vontade, ele ouve.", ref: "1 Jo√£o 5:14" },
        { id: 254, text: "√Äquele que √© poderoso para vos guardar de trope√ßar.", ref: "Judas 1:24" },
        { id: 255, text: "Eu sou o Alfa e o √îmega, o princ√≠pio e o fim.", ref: "Apocalipse 1:8" },
        { id: 256, text: "Eis que venho sem demora; guarda o que tens.", ref: "Apocalipse 3:11" },
        { id: 257, text: "Deus limpar√° de seus olhos toda a l√°grima.", ref: "Apocalipse 21:4" },
        { id: 258, text: "Em ti ser√£o aben√ßoadas todas as fam√≠lias da terra.", ref: "G√™nesis 12:3" },
        { id: 259, text: "Estou contigo, e te guardarei por onde quer que fores.", ref: "G√™nesis 28:15" },
        { id: 260, text: "O Senhor √© a minha for√ßa e o meu c√¢ntico.", ref: "√äxodo 15:2" },
        { id: 261, text: "Ir√° a minha presen√ßa contigo para te fazer descansar.", ref: "√äxodo 33:14" },
        { id: 262, text: "Amar√°s o teu pr√≥ximo como a ti mesmo. Eu sou o Senhor.", ref: "Lev√≠tico 19:18" },
        { id: 263, text: "Deus n√£o √© homem para que minta nem filho do homem.", ref: "N√∫meros 23:19" },
        { id: 264, text: "Amar√°s o Senhor teu Deus de todo o teu cora√ß√£o.", ref: "Deuteron√¥mio 6:5" },
        { id: 265, text: "Saber√°s que o Senhor teu Deus √© o Deus fiel.", ref: "Deuteron√¥mio 7:9" },
        { id: 266, text: "O Deus eterno √© a tua habita√ß√£o e ref√∫gio.", ref: "Deuteron√¥mio 33:27" },
        { id: 267, text: "Eu e a minha casa serviremos ao Senhor.", ref: "Josu√© 24:15" },
        { id: 268, text: "O Senhor olha para o cora√ß√£o.", ref: "1 Samuel 16:7" },
        { id: 269, text: "Deus √© o meu rochedo, nele confiarei.", ref: "2 Samuel 22:3" },
        { id: 270, text: "Buscai ao Senhor e a sua for√ßa continuamente.", ref: "1 Cr√¥nicas 16:11" },
        { id: 271, text: "Louvai ao Senhor, porque a sua benignidade √© eterna.", ref: "1 Cr√¥nicas 16:34" },
        { id: 272, text: "Tua √©, Senhor, a magnific√™ncia, o poder e a honra.", ref: "1 Cr√¥nicas 29:11" },
        { id: 273, text: "Se o meu povo orar e buscar a minha face.", ref: "2 Cr√¥nicas 7:14" },
        { id: 274, text: "Crede no Senhor vosso Deus, e estareis seguros.", ref: "2 Cr√¥nicas 20:20" },
        { id: 275, text: "A alegria do Senhor √© a vossa for√ßa.", ref: "Neemias 8:10" },
        { id: 276, text: "Eu sei que o meu Redentor vive.", ref: "J√≥ 19:25" },
        { id: 277, text: "Nenhum dos teus pensamentos pode ser impedido.", ref: "J√≥ 42:2" },
        { id: 278, text: "Bem-aventurado o homem que n√£o anda no conselho dos √≠mpios.", ref: "Salmos 1:1" },
        { id: 279, text: "Eu te amarei, √≥ Senhor, fortaleza minha.", ref: "Salmos 18:1" },
        { id: 280, text: "A palavra do Senhor √© comprovadamente verdadeira.", ref: "Salmos 18:30" },
        { id: 281, text: "Os c√©us declaram a gl√≥ria de Deus.", ref: "Salmos 19:1" },
        { id: 282, text: "Sejam agrad√°veis as medita√ß√µes do meu cora√ß√£o.", ref: "Salmos 19:14" },
        { id: 283, text: "Ensina-me, Senhor, as tuas veredas.", ref: "Salmos 25:4" },
        { id: 284, text: "Uma coisa pedi ao Senhor e a buscarei.", ref: "Salmos 27:4" },
        { id: 285, text: "Espera no Senhor e ele fortalecer√° o teu cora√ß√£o.", ref: "Salmos 27:14" },
        { id: 286, text: "Instruir-te-ei no caminho que deves seguir.", ref: "Salmos 32:8" },
        { id: 287, text: "Bem-aventurada √© a na√ß√£o cujo Deus √© o Senhor.", ref: "Salmos 33:12" },
        { id: 288, text: "O seu louvor estar√° continuamente na minha boca.", ref: "Salmos 34:1" },
        { id: 289, text: "O anjo do Senhor acampa-se ao redor dos que o temem.", ref: "Salmos 34:7" },
        { id: 290, text: "Perto est√° o Senhor dos que t√™m o cora√ß√£o quebrantado.", ref: "Salmos 34:18" },
        { id: 291, text: "Descansa no Senhor, e espera nele.", ref: "Salmos 37:7" },
        { id: 292, text: "Nunca vi desamparado o justo.", ref: "Salmos 37:25" },
        { id: 293, text: "Esperei com paci√™ncia no Senhor.", ref: "Salmos 40:1" },
        { id: 294, text: "A minha alma suspira por ti, √≥ Deus.", ref: "Salmos 42:1" },
        { id: 295, text: "Cria em mim, √≥ Deus, um cora√ß√£o puro.", ref: "Salmos 51:10" },
        { id: 296, text: "Lan√ßa o teu cuidado sobre o Senhor.", ref: "Salmos 55:22" },
        { id: 297, text: "No dia em que eu temer, hei de confiar em ti.", ref: "Salmos 56:3" },
        { id: 298, text: "De Deus vem a minha salva√ß√£o.", ref: "Salmos 62:1" },
        { id: 299, text: "Confiai nele, √≥ povo, em todo o tempo.", ref: "Salmos 62:8" },
        { id: 300, text: "Em Deus louvarei a sua palavra.", ref: "Salmos 56:10" }
    ];

    window.showTab = (t) => {
        ['home', 'rank', 'config'].forEach(tab => document.getElementById(`tab-${tab}`).classList.toggle('hidden', tab !== t));
        ['home', 'rank', 'config'].forEach(nav => {
           const el = document.getElementById(`nav-${nav}`);
           if(el) el.classList.toggle('nav-active', nav === t);
        });
        if(t === 'rank') loadRanking();
    };

    window.logout = () => signOut(auth).then(() => location.reload());
    window.resetVerses = () => { localStorage.removeItem("seen_verses"); alert("Lista reiniciada!"); location.reload(); };

    window.handleAuth = async (m) => {
        const e = document.getElementById('login-email').value;
        const p = document.getElementById('login-pass').value;
        try {
            if(m === 'signup') {
                const r = await createUserWithEmailAndPassword(auth, e, p);
                await setDoc(doc(db, "users", r.user.uid), { xp: 0, name: e.split('@')[0] });
            } else { await signInWithEmailAndPassword(auth, e, p); }
        } catch(err) { alert("Erro: " + err.message); }
    };

    onAuthStateChanged(auth, u => {
        document.getElementById('auth-screen').classList.toggle('hidden', !!u);
        document.getElementById('main-screen').classList.toggle('hidden', !u);
        document.getElementById('nav').classList.toggle('hidden', !u);
        if(u) { loadUserData(u.uid); fetchVerse(); }
    });

    async function loadUserData(uid) {
        const s = await getDoc(doc(db, "users", uid));
        if(s.exists()) {
            const d = s.data();
            document.getElementById('xp-val').innerText = d.xp || 0;
            document.getElementById('level-val').innerText = Math.floor((d.xp || 0) / 100) + 1;
            document.getElementById('user-display').innerText = d.name.toUpperCase();
        }
    }

    function fetchVerse() {
        let seen = JSON.parse(localStorage.getItem("seen_verses") || "[]");
        if (seen.length >= BIBLE_DATABASE.length) seen = [];
        const available = BIBLE_DATABASE.filter(v => !seen.includes(v.id));
        const selected = available[Math.floor(Math.random() * available.length)];
        seen.push(selected.id);
        localStorage.setItem("seen_verses", JSON.stringify(seen));
        window.currentVerse = selected.text;
        document.getElementById('verse-text').innerText = `"${selected.text}"`;
        document.getElementById('verse-ref').innerText = selected.ref.toUpperCase();
    }

    window.generateStudy = async () => {
        const btn = document.getElementById('btn-study');
        btn.innerText = "PROFESSOR ANALISANDO...";
        btn.disabled = true;

        try {
            const response = await fetch('/api/generate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ verse: window.currentVerse })
            });

            const data = await response.json();
            if (data.error) throw new Error(data.error);

            const fullText = data.choices[0].message.content;
            const parts = fullText.split("PERGUNTA:");
            const explanation = parts[0].replace("EXPLICA√á√ÉO:", "").trim();
            const quizPart = parts[1];
            const questionText = quizPart.split("A)")[0].trim();
            const correctPart = fullText.split("CORRETA:")[1];
            correctAnswer = correctPart.trim()[0].toUpperCase();

            document.getElementById('ai-response').innerText = explanation;
            document.getElementById('quiz-question').innerText = questionText;
            
            const opts = fullText.match(/[A-D]\) .+/g);
            const quizDiv = document.getElementById('quiz-options');
            quizDiv.innerHTML = "";
            
            opts.forEach(o => {
                const button = document.createElement('button');
                button.className = "quiz-option";
                button.innerText = o;
                button.onclick = () => checkAnswer(o[0].toUpperCase(), button);
                quizDiv.appendChild(button);
            });

            document.getElementById('study-area').classList.remove('hidden');
            btn.innerText = "ESTUDO GERADO";
        } catch (err) {
            alert("Erro: " + err.message);
            btn.disabled = false;
            btn.innerText = "TENTAR NOVAMENTE";
        }
    };

    async function checkAnswer(c, btn) {
        document.querySelectorAll('.quiz-option').forEach(b => b.disabled = true);
        const userRef = doc(db, "users", auth.currentUser.uid);
        if(c === correctAnswer) {
            btn.style.background = "#d7ffb8";
            await updateDoc(userRef, { xp: increment(25) });
            alert("Correto! +25 XP.");
        } else {
            btn.style.background = "#ffd7d7";
            await updateDoc(userRef, { xp: increment(5) });
            alert(`A certa era ${correctAnswer}. +5 XP.`);
        }
        setTimeout(() => location.reload(), 2000);
    }

    async function loadRanking() {
        const list = document.getElementById('ranking-list');
        list.innerHTML = `<p style="text-align:center; padding:20px; color:#afafaf;">Sincronizando l√≠deres...</p>`;
        
        try {
            const q = query(collection(db, "users"), orderBy("xp", "desc"), limit(10));
            const snapshot = await getDocs(q);
            
            list.innerHTML = "";
            let position = 1;

            snapshot.forEach(docSnap => {
                const data = docSnap.data();
                const xp = data.xp || 0;
                const level = Math.floor(xp / 100) + 1;
                
                const item = document.createElement('div');
                item.className = 'rank-item';
                item.innerHTML = `
                    <span class="rank-pos">${position}¬∫</span>
                    <span class="rank-name">
                        ${data.name.toUpperCase()} 
                        <span class="rank-level">N√çVEL ${level}</span>
                    </span>
                    <span class="rank-xp">${xp} XP</span>
                `;
                list.appendChild(item);
                position++;
            });

            if (position === 1) {
                list.innerHTML = `<p style="text-align:center; padding:20px;">Nenhum usu√°rio encontrado.</p>`;
            }

        } catch (error) {
            console.error("Erro ao carregar ranking:", error);
            list.innerHTML = `
                <div style="padding:20px; text-align:center; color:var(--error);">
                    <b>Erro de Sincroniza√ß√£o</b><br>
                    <small>Certifique-se de que os √≠ndices do Firestore foram criados.</small>
                </div>
            `;
        }
    }
</script>
</body>
</html>

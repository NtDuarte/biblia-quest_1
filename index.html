<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BibliaQuest | Duarte</title>

<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">

<style>
:root {
  --primary: #58cc02;
  --blue: #1cb0f6;
  --bg: #ffffff;
  --text: #3c3c3c;
}

body {
  font-family: 'Nunito', sans-serif;
  background: #f7f7f7;
  margin: 0;
  display: flex;
  justify-content: center;
  color: var(--text);
}

#app {
  width: 100%;
  max-width: 480px;
  background: white;
  min-height: 100vh;
  padding: 25px;
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
}

.hidden { display: none; }

.card {
  border: 2px solid #e5e5e5;
  border-bottom: 6px solid #e5e5e5;
  border-radius: 20px;
  padding: 20px;
  margin: 15px 0;
}

.btn-duo {
  width: 100%;
  padding: 16px;
  border: none;
  border-radius: 16px;
  font-size: 16px;
  font-weight: 900;
  text-transform: uppercase;
  cursor: pointer;
  background: var(--primary);
  color: white;
  border-bottom: 6px solid #46a302;
  margin-top: 10px;
}

.btn-blue {
  background: var(--blue);
  border-bottom: 6px solid #1899d6;
}

input {
  width: 100%;
  padding: 14px;
  margin: 10px 0;
  border-radius: 14px;
  border: 2px solid #e5e5e5;
  background: #f7f7f7;
}

.nav-bar {
  display: flex;
  justify-content: space-around;
  position: fixed;
  bottom: 0;
  width: 100%;
  max-width: 480px;
  background: white;
  border-top: 2px solid #e5e5e5;
  padding: 12px;
}

.nav-item {
  font-weight: 900;
  cursor: pointer;
  color: #aaa;
}

.nav-active { color: var(--blue); }

#ai-response {
  white-space: pre-wrap;
  animation: fade 0.4s ease-in;
}

@keyframes fade {
  from { opacity: 0; transform: translateY(6px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>
</head>

<body>
<div id="app">

<!-- LOGIN -->
<div id="auth-screen">
  <h1 style="text-align:center;color:var(--primary)">BibliaQuest</h1>
  <input id="login-email" type="email" placeholder="E-mail">
  <input id="login-pass" type="password" placeholder="Senha">
  <button class="btn-duo" onclick="handleAuth('login')">Entrar</button>
  <button class="btn-duo btn-blue" onclick="handleAuth('signup')">Criar conta</button>
</div>

<!-- APP -->
<div id="main-screen" class="hidden">

<div class="card">
  <h3>ðŸ“– Palavra do Dia</h3>
  <p id="verse-text">Carregando...</p>
  <small id="verse-ref"></small>
</div>

<button class="btn-duo" id="btn-study" onclick="generateStudy()">Gerar Estudo</button>

<div id="study-area" class="hidden">
  <div class="card" id="ai-response"></div>
  <button class="btn-duo btn-blue" onclick="finishTask()">Concluir (+10 XP)</button>
</div>

</div>

<div class="nav-bar hidden" id="nav">
  <div class="nav-item nav-active">Estudo</div>
  <div class="nav-item" onclick="logout()" style="color:#ff4b4b">Sair</div>
</div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCAqU2eK-r5BBSud1nSZJHSbykATXdQNS4",
  authDomain: "bibliaquest-fbc44.firebaseapp.com",
  projectId: "bibliaquest-fbc44",
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

window.handleAuth = async (type) => {
  const e = login-email.value;
  const p = login-pass.value;
  try {
    if(type === "signup") {
      const r = await createUserWithEmailAndPassword(auth, e, p);
      await setDoc(doc(db, "users", r.user.uid), { xp: 0 });
    } else {
      await signInWithEmailAndPassword(auth, e, p);
    }
  } catch(err) { alert(err.message); }
};

window.logout = () => signOut(auth);

onAuthStateChanged(auth, (u) => {
  auth-screen.classList.toggle("hidden", !!u);
  main-screen.classList.toggle("hidden", !u);
  nav.classList.toggle("hidden", !u);
  if(u) fetchVerse();
});

async function fetchVerse() {
  try {
    const r = await fetch("https://bible-api.com/random?translation=almeida");
    const d = await r.json();
    window.currentVerse = d.text;
    verse-text.innerText = d.text;
    verse-ref.innerText = d.reference;
  } catch {
    verse-text.innerText = "O Senhor Ã© meu pastor; nada me faltarÃ¡.";
    verse-ref.innerText = "Salmos 23:1";
    window.currentVerse = verse-text.innerText;
  }
}

window.generateStudy = async () => {
  btn-study.innerText = "Gerando...";
  btn-study.disabled = true;
  study-area.classList.remove("hidden");

  ai-response.innerText = `
ðŸ“– ReflexÃ£o

Leia este versÃ­culo com calma.
O que ele revela sobre Deus?
O que ele pede de vocÃª hoje?

A Palavra nÃ£o falha.
`;

  btn-study.innerText = "Estudo pronto";
};

window.finishTask = async () => {
  await setDoc(doc(db,"users",auth.currentUser.uid),{xp:increment(10)},{merge:true});
  alert("ParabÃ©ns! +10 XP");
  location.reload();
};
</script>

</body>
</html>
